<% provide(:title, "Edit user") %>
<h1 class="text-5xl text-green-600">＜編集＞</h1>

<%= form_with(model: @user, local: true) do |form| %>
  <%= render  "shared/error_messages" %>
  
    <%= form.label :name, '名前' %>
    <%= form.text_field :name, class: "w-40 py-2 border-b focus:outline-none focus:border-b-2 focus:border-indigo-500 placeholder-gray-500 placeholder-opacity-50", placeholder: "山田太郎" %>

    <div class = "radio-button">
        <%= form.radio_button :sex, true %>
        <%= form.label :sex, '男', value: true %>
      </div>
      <div class = "radio-button">
        <%= form.radio_button :sex, false %>
        <%= form.label :sex, '女', value: false %>
      </div>
  
    <%= form.label :birthday, '誕生日' %>
    <%= form.date_field :birthday, class: "w-40 py-2 border-b focus:outline-none focus:border-b-2 focus:border-indigo-500 placeholder-gray-500 placeholder-opacity-50" %>
  
    <%= form.label :region, 'お住まい' %>
    <%= form.text_field :region, class: "w-40 py-2 border-b focus:outline-none focus:border-b-2 focus:border-indigo-500 placeholder-gray-500 placeholder-opacity-50" %>
  
    <%= form.label :email, 'メールアドレス' %>
    <%= form.email_field :email, class: "w-40 py-2 border-b focus:outline-none focus:border-b-2 focus:border-indigo-500 placeholder-gray-500 placeholder-opacity-50" %>
  
    <%= form.label :password, 'パスワード' %>
    <%= form.password_field :password, class: "w-40 py-2 border-b focus:outline-none focus:border-b-2 focus:border-indigo-500 placeholder-gray-500 placeholder-opacity-50" %>
  
    <%= form.label :password_confirmation, 'パスワード(確認)' %>
    <%= form.password_field :password_confirmation, class: "w-40 py-2 border-b focus:outline-none focus:border-b-2 focus:border-indigo-500 placeholder-gray-500 placeholder-opacity-50" %>

    <div class="mt-3 mb-5 <%= @user.errors.include?(:avatar) ? "validation_errors" : "" %>">
  <!------ 画像の添付 ------>
  <%= form.label :avatar, '画像(5MBまで)', class: "form-label fw-bold" %><br>
  <%= form.file_field :avatar, onchange: "avatarImage(this);", accept: "image/jpeg,image/gif,image/png", class: "mb-3" %>
  <%# <%= render 'layouts/error_messages',class: "invalid-feedback", obj: @user, key: :avatar %>
  <!------ 添付画像のプレビューを表示 ------>
  <div id="avatar" >
    <img id="avatar_preview" class="mb-3" width="100">
  </div>
  <!------ 現在DBに登録(保存)されている画像を表示 ------>
  <% if @user.avatar.present? %> <!-- @user.avatarが存在する場合のみ image_tag を使用(if文ないとエラーが出る) -->
    <p><span><b>[現在登録されている画像]</b></span></p>
    <%= image_tag @user.avatar, width: 200, class: "mb-2" %>
  <% end %>
</div>

  
    <%= form.submit '登録', class: "w-full px-4 py-2 mt-4 text-sm font-medium text-white uppercase transition-colors duration-200 transform bg-blue-600 rounded-md lg:w-auto hover:bg-blue-500 focus:outline-none focus:bg-blue-500" %>
  <% end %>
  
<!------ プレビュー表示用の JavaScript ------->
<script>
  function avatarImage(obj){
      var fileReader = new FileReader();
      fileReader.onload = (function() {
        document.getElementById('avatar_preview').src = fileReader.result;
      });
      fileReader.readAsDataURL(obj.files[0]);
  }
</script>
